function parse(t,e){for(var n,r=[],o=0,i=0,a="",c=e&&e.delimiter||"/";null!=(n=PATH_REGEXP.exec(t));){var s=n[0],u=n[1],p=n.index;if(a+=t.slice(i,p),i=p+s.length,u)a+=u[1];else{var l=t[i],d=n[2],f=n[3],h=n[4],g=n[5],m=n[6],y=n[7];a&&(r.push(a),a="");var E=null!=d&&null!=l&&l!==d,v="+"===m||"*"===m,x="?"===m||"*"===m,C=n[2]||c,R=h||g;r.push({name:f||o++,prefix:d||"",delimiter:C,optional:x,repeat:v,partial:E,asterisk:!!y,pattern:R?escapeGroup(R):y?".*":"[^"+escapeString(C)+"]+?"})}}return i<t.length&&(a+=t.substr(i)),a&&r.push(a),r}function compile(t,e){return tokensToFunction(parse(t,e))}function encodeURIComponentPretty(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(t){for(var e=new Array(t.length),n=0;n<t.length;n++)"object"==typeof t[n]&&(e[n]=new RegExp("^(?:"+t[n].pattern+")$"));return function(n,r){for(var o="",i=n||{},a=r||{},c=a.pretty?encodeURIComponentPretty:encodeURIComponent,s=0;s<t.length;s++){var u=t[s];if("string"!=typeof u){var p,l=i[u.name];if(null==l){if(u.optional){u.partial&&(o+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(isarray(l)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(l)+"`");if(0===l.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var d=0;d<l.length;d++){if(p=c(l[d]),!e[s].test(p))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(p)+"`");o+=(0===d?u.prefix:u.delimiter)+p}}else{if(p=u.asterisk?encodeAsterisk(l):c(l),!e[s].test(p))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+p+'"');o+=u.prefix+p}}else o+=u}return o}}function escapeString(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function escapeGroup(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function attachKeys(t,e){return t.keys=e,t}function flags(t){return t.sensitive?"":"i"}function regexpToRegexp(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(t,e)}function arrayToRegexp(t,e,n){for(var r=[],o=0;o<t.length;o++)r.push(pathToRegexp(t[o],e,n).source);return attachKeys(new RegExp("(?:"+r.join("|")+")",flags(n)),e)}function stringToRegexp(t,e,n){return tokensToRegExp(parse(t,n),e,n)}function tokensToRegExp(t,e,n){isarray(e)||(n=e||n,e=[]),n=n||{};for(var r=n.strict,o=!1!==n.end,i="",a=0;a<t.length;a++){var c=t[a];if("string"==typeof c)i+=escapeString(c);else{var s=escapeString(c.prefix),u="(?:"+c.pattern+")";e.push(c),c.repeat&&(u+="(?:"+s+u+")*"),u=c.optional?c.partial?s+"("+u+")?":"(?:"+s+"("+u+"))?":s+"("+u+")",i+=u}}var p=escapeString(n.delimiter||"/"),l=i.slice(-p.length)===p;return r||(i=(l?i.slice(0,-p.length):i)+"(?:"+p+"(?=$))?"),i+=o?"$":r&&l?"":"(?="+p+"|$)",attachKeys(new RegExp("^"+i,flags(n)),e)}function pathToRegexp(t,e,n){return isarray(e)||(n=e||n,e=[]),n=n||{},t instanceof RegExp?regexpToRegexp(t,e):isarray(t)?arrayToRegexp(t,e,n):stringToRegexp(t,e,n)}var map={"hepsiburada.com":{product_detail:"/:product-p-:sku",product_name:"document.getElementsByClassName('name')[0].innerText",product_brand:"document.getElementsByClassName('brand-name')[0].innerText",product_price:"document.getElementsByClassName('price')[0].innerText"},"urun.n11.com":{product_detail:"/:category/:product-P:sku",product_name:"window.dataLayer[0].title",product_brand:"window.dataLayer[0].pBrand",product_price:"window.dataLayer[0].pDiscountedPrice"},"urun.gittigidiyor.com":{product_detail:"/:category/:product-:sku",product_name:"window.TRACKING_PRODUCT_TITLE",product_brand:"window.TRACKING_PRODUCT_BRAND",product_price:"window.TRACKING_PRODUCT_PRICE"},"teknosa.com":{product_detail:"/urunler/:sku/:product",product_name:"$.Teknosa.ProductDetail.ProductName",product_brand:"$.Teknosa.ProductDetail.ProductBrandName",product_price:"$.Teknosa.ProductDetail.ProductPrice"}},tracker_map={"akakce.com":{detect_url:"/:category/en-ucuz-:product-fiyati,:sku.html",selectors:[".iC"]}},brands=[],toString={}.toString,isArray=function(t){return"[object Array]"===toString.call(t)},isarray=Array.isArray||isArray,PATH_REGEXP=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),EXPECTED_SCORE=7,HEPSIBURADA="hepsiburada.com",SEARCH_URL="http://www.hepsiburada.com/ara?q=";"https:"===location.protocol&&(SEARCH_URL="https://service.prerender.io/"+SEARCH_URL);var HOST_JOKER_PREFIX="www.",QUERY_SLICE_COUNT=4,DEFAULT_CURRENCY="TL",BRAND_DETECTION=!1,DEFAULT_ICON="../assets/icon128.png",AJAX_SNIFFER=!1,HASH_CHANGE_SNIFFER=!1,CLICK_TRACKER=!0;String.prototype.levenshtein=function(t,e,n,r){var o=this;if(t||(t=""),e||(e=1),n||(n=1),r||(r=1),o===t)return 0;var i=o.length,a=t.length;if(0===i)return a*e;if(0===a)return i*r;var c,s,u,p,l,d,f=new Array(a+1),h=new Array(a+1);for(s=0;s<=a;s++)f[s]=s*e;for(c=0;c<i;c++){for(h[0]=f[0]+r,s=0;s<a;s++)u=f[s]+(o[c]===t[s]?0:n),p=f[s+1]+r,p<u&&(u=p),l=h[s]+e,l<u&&(u=l),h[s+1]=u;d=f,f=h,h=d}return u=f[a]},String.prototype.toLowerCaseTurkish=function(){for(var t=["Ğ","Ü","Ş","İ","I","Ö","Ç"],e=["ğ","ü","ş","i","ı","ö","ç"],n=this.split(""),r=0;r<n.length;r++){var o=t.indexOf(n[r]);o>=0&&(n[r]=e[o])}return n.join("").toLowerCase()},String.prototype.toUpperCaseTurkish=function(){for(var t=["ğ","ü","ş","i","ı","ö","ç"],e=["Ğ","Ü","Ş","İ","I","Ö","Ç"],n=this.split(""),r=0;r<n.length;r++){var o=t.indexOf(n[r]);o>=0&&(n[r]=e[o])}return n.join("").toUpperCase()},String.prototype.toEnglish=function(){for(var t=["ğ","ü","ş","ı","ö","ç","Ğ","Ü","Ş","İ","I","Ö","Ç"],e=["g","u","s","i","o","c","G","U","S","I","I","O","C"],n=this.split(""),r=0;r<n.length;r++){var o=t.indexOf(n[r]);o>=0&&(n[r]=e[o])}return n.join("")},String.prototype.soundEx=function(){for(var t,e,n,r=this,o=[0,0,0,0],i={B:1,F:1,P:1,V:1,C:2,G:2,J:2,K:2,Q:2,S:2,X:2,Z:2,D:3,T:3,L:4,M:5,N:5,R:6},a=0,c=0;(e=r.charAt(a++))&&c<4;)(t=i[e])?t!==n&&(o[c++]=n=t):(c+=1===a,n=0);return o[0]=r.charAt(0),o.join("")},Array.prototype.sortByKey=function(t,e){return e||(e=!1),this.sort(function(n,r){var o=n[t],i=r[t];return e?-1*(o<i?-1:o>i?1:0):o<i?-1:o>i?1:0})},String.prototype.similar=function(t){for(var e=this,n=[],r=-1,o={},i=[],a=[],c=0;c<t.length;c++){var s=t[c].toLowerCase();n.push({original:s,clean:s.toEnglish(),soundEx:s.toEnglish().toUpperCase().soundEx()})}for(var u=0;u<n.length;u++){var p=n[u],l=e.levenshtein(p.original,1,2,1),d=e.toEnglish().levenshtein(p.clean,1,2,1),f=0===l||0===d?0:e.toEnglish().toUpperCase().soundEx().levenshtein(p.soundEx,1,2,1);p.ans=[l,d,f],p.calc=Math.floor(f+d/2+l),(p.calc<=r||r<0)&&(r=p.calc,o=p),i.push({o:p.original,lo:l,lc:d,ls:f,c:p.calc})}i.sortByKey("c");for(var h=0;h<i.length;h++){var g=i[h];a.push({original:g.o,score:g.c,levenshtein:g.lo,english:g.lc,soundEx:g.ls})}return{result:o.original,score:r,anothers:a}},String.prototype.pass=function(){for(var t=this,e=0;e<arguments.length;e++){var n=arguments[e];t=t.replace(new RegExp(function(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}("%%")),n)}return t};var Utils={isHepsiburada:function(){return location.host.indexOf(HEPSIBURADA)>-1},collectionArrToSingleObj:function(t){for(var e={},n=[],r=0;r<t.length;r++)for(var o in t[r])if(t[r].hasOwnProperty(o)){var i=t[r][o];e[o]=i,n.push(i)}return e},getStrId:function(){return(+new Date+"").split("").map(function(t){return String.fromCharCode(97+parseInt(t))}).join("")},guid:function(){for(var t=[],e=0;e<8;e++)t.push(this.s4());return t.join("-")},s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},Path=function(t,e){return this.keys=[],this.pattern=pathToRegexp(t,this.keys),this.result=this.pattern.exec(e),this};Path.prototype.test=function(){return this.result},Path.prototype.params=function(){return this.getParams(this.result,this.keys)},Path.prototype.getParams=function(t,e){for(var n={},r=1;r<t.length;r++){var o=e[r-1].name,i=this.decodeParam(t[r]);!i&&Object.prototype.hasOwnProperty.call(n,o)||(n[o]=i)}return n},Path.prototype.decodeParam=function(t){if("string"!=typeof t||0===t.length)return t;try{return decodeURIComponent(t)}catch(e){throw e instanceof URIError&&(e.message="Failed to decode param '"+t+"'",e.status=e.statusCode=400),e}};var Proxy={inject:function(t){var e=document.createElement("script");e.type="text/javascript",e.text="("+t+')("");',document.body.appendChild(e)},execute:function(t,e){return new window.Promise(function(n,r){var o="execute_"+Utils.getStrId();document.body.addEventListener(o,function(e){var r={};r[t]=e.detail.toString().trim(),n(r)}),this.inject("function () {         document.body.dispatchEvent(new CustomEvent('%%', {detail: eval('%%')}));      }".pass(o,e))}.bind(this))},ajax:function(t){var e="ajax_"+Utils.getStrId();document.body.addEventListener(e,function(e){t(e.detail.toString().trim())}),this.inject("function() {        var oldSend = XMLHttpRequest.prototype.send;        XMLHttpRequest.prototype.send = function () {          var oldOnLoad = this.onload;          this.onload = function () {             document.body.dispatchEvent(new CustomEvent('%%', {detail: this.responseText}));             if (oldOnLoad) {              oldOnLoad.apply(this, arguments);            }          };          oldSend.apply(this, arguments);        };      }".pass(e))},hashChange:function(t){var e="hashChange_"+Utils.getStrId();document.body.addEventListener(e,function(e){t(e.detail.toString().trim())}),this.inject("function () {      window.addEventListener('hashchange', function (e) {        document.body.dispatchEvent(new CustomEvent('%%', {detail: location.href}));      }, false);    }".pass(e))},clickTracker:function(t,e){var n="clickTracker_"+Utils.getStrId();document.body.addEventListener(n,function(t){e(t.detail.toString().trim())}),this.inject("function () {      '%%'.split('%')        .forEach(function (s) {          document.querySelectorAll(s)            .forEach(function (e) {              e.addEventListener('click', function (e) {                document.body.dispatchEvent(new CustomEvent('%%', {detail: this.href}))              }, false);            });        });    }".pass(t.join("%"),n))}},Sniffer=function(){};Sniffer.prototype.ajax=function(t){Proxy.ajax(t)},Sniffer.prototype.hashChange=function(t){Proxy.hashChange(t)};var Tracker=function(){};Tracker.prototype.click=function(t,e){Proxy.clickTracker(t,e)};var Search=function(t,e){var n=document.createElement("iframe"),r=Utils.getStrId();n.style.display="none",n.id=r,n.src=SEARCH_URL+t,n.name=e,document.body.appendChild(n),n.onload=function(){}},isTop=!0,host=location.host,site=host.startsWith(HOST_JOKER_PREFIX)?host.substr(HOST_JOKER_PREFIX.length):host,App={init:function(t){var e=new Path(t.product_detail,location.pathname);if(this.initSniffers(),e.test()){e.params();App.collect(t)}},tracker:function(t){var e=new Path(t.detect_url,location.pathname);if(e.test()){e.params();this.initTrackers(t.selectors)}},initSniffers:function(){var t=new Sniffer;AJAX_SNIFFER&&t.ajax(this.onAjax.bind(this)),HASH_CHANGE_SNIFFER&&t.hashChange(this.onHashChange.bind(this))},initTrackers:function(t){var e=new Tracker;CLICK_TRACKER&&e.click(t,function(t){App.sendToPlugin({clickTracker:t})})},onAjax:function(t){console.log("[SNIFFER-AJAX]",t)},onHashChange:function(t){console.log("[SNIFFER-HASH-CHANGE]",t)},collect:function(t){window.Promise.all([Proxy.execute("product_name",t.product_name),Proxy.execute("product_brand",t.product_brand),Proxy.execute("product_price",t.product_price)]).then(App.done)},detect:function(t){for(var e=[],n=0;n<t.length;n++)e=e.concat(App.analyze(t[n]));return e=e.filter(function(t,e,n){return n.indexOf(t)===e}),e.length},done:function(t){var e=Utils.collectionArrToSingleObj(t);if(t=[e.product_name,e.product_brand],!BRAND_DETECTION||App.detect(t)){var n=App.query(t);Search(n,e.product_price)}},query:function(t){for(var e=[],n=[],r=0;r<t.length;r++)for(var o=0;o<t.length;o++)r!==o&&t[r].indexOf(t[o])>-1&&n.push(o);for(var i=0;i<t.length;i++)-1===n.indexOf(i)&&e.push(t[i]);return e.join(" ").split(" ").map(function(t){return t.trim()}).slice(0,QUERY_SLICE_COUNT).join(" ").trim().toLowerCase()},analyze:function(t){for(var e=t.trim().toLowerCase().split(" "),n=[],r=0;r<e.length;r++){var o=e.slice(r,1+r).join(" ").trim(),i=e.slice(r,2+r).join(" ").trim(),a=e.slice(r,3+r).join(" ").trim(),c=o.similar(brands),s=i.similar(brands),u=a.similar(brands),p=App.select([c,s,u],[o,i,a]);p.score<=EXPECTED_SCORE&&n.push(p)}return n.map(function(t){return t.text})},select:function(t,e){var n=t.map(function(t,n){return{text:t.result,score:t.score,from:e[n]}});return App.getMinAndMax(n,"score").min},getMinAndMax:function(t,e){if(!t.length)return null;for(var n,r=t[0],o=t[0],i=t.length-1;i>=0;i--)n=t[i],n[e]<r[e]&&(r=n),n[e]>o[e]&&(o=n);return{min:r,max:o}},sendToPlugin:function(t){chrome.runtime.sendMessage(t,function(t){})},pushDevLog:function(t){App.sendToPlugin({devLog:t})}};window.onload=function(){map.hasOwnProperty(site)?Utils.isHepsiburada()||App.init(map[site]):tracker_map.hasOwnProperty(site)&&App.tracker(tracker_map[site]),App.sendToPlugin({run:!0})};