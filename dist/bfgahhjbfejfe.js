function parse(t,e){for(var r,n=[],o=0,i=0,a="",c=e&&e.delimiter||"/";null!=(r=PATH_REGEXP.exec(t));){var s=r[0],u=r[1],p=r.index;if(a+=t.slice(i,p),i=p+s.length,u)a+=u[1];else{var d=t[i],l=r[2],f=r[3],h=r[4],g=r[5],_=r[6],m=r[7];a&&(n.push(a),a="");var y=null!=l&&null!=d&&d!==l,E="+"===_||"*"===_,v="?"===_||"*"===_,T=r[2]||c,A=h||g;n.push({name:f||o++,prefix:l||"",delimiter:T,optional:v,repeat:E,partial:y,asterisk:!!m,pattern:A?escapeGroup(A):m?".*":"[^"+escapeString(T)+"]+?"})}}return i<t.length&&(a+=t.substr(i)),a&&n.push(a),n}function compile(t,e){return tokensToFunction(parse(t,e))}function encodeURIComponentPretty(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,n){for(var o="",i=r||{},a=n||{},c=a.pretty?encodeURIComponentPretty:encodeURIComponent,s=0;s<t.length;s++){var u=t[s];if("string"!=typeof u){var p,d=i[u.name];if(null==d){if(u.optional){u.partial&&(o+=u.prefix);continue}throw new TypeError('Expected "'+u.name+'" to be defined')}if(isarray(d)){if(!u.repeat)throw new TypeError('Expected "'+u.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(u.optional)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var l=0;l<d.length;l++){if(p=c(d[l]),!e[s].test(p))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but received `'+JSON.stringify(p)+"`");o+=(0===l?u.prefix:u.delimiter)+p}}else{if(p=u.asterisk?encodeAsterisk(d):c(d),!e[s].test(p))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but received "'+p+'"');o+=u.prefix+p}}else o+=u}return o}}function escapeString(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function escapeGroup(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function attachKeys(t,e){return t.keys=e,t}function flags(t){return t.sensitive?"":"i"}function regexpToRegexp(t,e){var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(t,e)}function arrayToRegexp(t,e,r){for(var n=[],o=0;o<t.length;o++)n.push(pathToRegexp(t[o],e,r).source);return attachKeys(new RegExp("(?:"+n.join("|")+")",flags(r)),e)}function stringToRegexp(t,e,r){return tokensToRegExp(parse(t,r),e,r)}function tokensToRegExp(t,e,r){isarray(e)||(r=e||r,e=[]),r=r||{};for(var n=r.strict,o=!1!==r.end,i="",a=0;a<t.length;a++){var c=t[a];if("string"==typeof c)i+=escapeString(c);else{var s=escapeString(c.prefix),u="(?:"+c.pattern+")";e.push(c),c.repeat&&(u+="(?:"+s+u+")*"),u=c.optional?c.partial?s+"("+u+")?":"(?:"+s+"("+u+"))?":s+"("+u+")",i+=u}}var p=escapeString(r.delimiter||"/"),d=i.slice(-p.length)===p;return n||(i=(d?i.slice(0,-p.length):i)+"(?:"+p+"(?=$))?"),i+=o?"$":n&&d?"":"(?="+p+"|$)",attachKeys(new RegExp("^"+i,flags(r)),e)}function pathToRegexp(t,e,r){return isarray(e)||(r=e||r,e=[]),r=r||{},t instanceof RegExp?regexpToRegexp(t,e):isarray(t)?arrayToRegexp(t,e,r):stringToRegexp(t,e,r)}var map={"hepsiburada.com":{product_detail:"/:product-p-:sku",product_name:"utagData.product_name_array",product_brand:"utagData.product_brand",product_price:"utagData.product_prices[0]"},"urun.n11.com":{product_detail:"/:category/:product-P:sku",product_name:"window.dataLayer[0].title",product_brand:"window.dataLayer[0].pBrand",product_price:"window.dataLayer[0].pDiscountedPrice"},"urun.gittigidiyor.com":{product_detail:"/:category/:product-:sku",product_name:"window.TRACKING_PRODUCT_TITLE",product_brand:"window.TRACKING_PRODUCT_BRAND",product_price:"window.TRACKING_PRODUCT_PRICE"},"teknosa.com":{product_detail:"/urunler/:sku/:product",product_name:"extend_google_tag_params.cd_product_name",product_brand:"extend_google_tag_params.cd_product_brand",product_price:"extend_google_tag_params.cd_product_price"},"trendyol.com":{product_detail:"/:brand/:uri",product_name:"__PRODUCT_DETAIL_APP_INITIAL_STATE__.product.name",product_brand:"__PRODUCT_DETAIL_APP_INITIAL_STATE__.product.brand.beautifiedName",product_price:"__PRODUCT_DETAIL_APP_INITIAL_STATE__.product.price.sellingPrice.value.toString()"}},tracker_map={"akakce.com":{detect_url:"/:category/en-ucuz-:product-fiyati,:sku.html",selectors:[".iC"]}},brands=[],toString={}.toString,isArray=function(t){return"[object Array]"===toString.call(t)},isarray=Array.isArray||isArray,PATH_REGEXP=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),EXPECTED_SCORE=7,HEPSIBURADA="hepsiburada.com",SEARCH_URL="https://www.hepsiburada.com/ara?q=",HOST_JOKER_PREFIX="www.",QUERY_SLICE_COUNT=4,DEFAULT_CURRENCY="TL",BRAND_DETECTION=!1,DEFAULT_ICON="../assets/icon128.png",AJAX_SNIFFER=!1,HASH_CHANGE_SNIFFER=!1,CLICK_TRACKER=!0;String.prototype.levenshtein=function(t,e,r,n){var o=this;if(t||(t=""),e||(e=1),r||(r=1),n||(n=1),o===t)return 0;var i=o.length,a=t.length;if(0===i)return a*e;if(0===a)return i*n;var c,s,u,p,d,l,f=new Array(a+1),h=new Array(a+1);for(s=0;s<=a;s++)f[s]=s*e;for(c=0;c<i;c++){for(h[0]=f[0]+n,s=0;s<a;s++)u=f[s]+(o[c]===t[s]?0:r),p=f[s+1]+n,p<u&&(u=p),d=h[s]+e,d<u&&(u=d),h[s+1]=u;l=f,f=h,h=l}return u=f[a]},String.prototype.toLowerCaseTurkish=function(){for(var t=["Ğ","Ü","Ş","İ","I","Ö","Ç"],e=["ğ","ü","ş","i","ı","ö","ç"],r=this.split(""),n=0;n<r.length;n++){var o=t.indexOf(r[n]);o>=0&&(r[n]=e[o])}return r.join("").toLowerCase()},String.prototype.toUpperCaseTurkish=function(){for(var t=["ğ","ü","ş","i","ı","ö","ç"],e=["Ğ","Ü","Ş","İ","I","Ö","Ç"],r=this.split(""),n=0;n<r.length;n++){var o=t.indexOf(r[n]);o>=0&&(r[n]=e[o])}return r.join("").toUpperCase()},String.prototype.toEnglish=function(){for(var t=["ğ","ü","ş","ı","ö","ç","Ğ","Ü","Ş","İ","I","Ö","Ç"],e=["g","u","s","i","o","c","G","U","S","I","I","O","C"],r=this.split(""),n=0;n<r.length;n++){var o=t.indexOf(r[n]);o>=0&&(r[n]=e[o])}return r.join("")},String.prototype.soundEx=function(){for(var t,e,r,n=this,o=[0,0,0,0],i={B:1,F:1,P:1,V:1,C:2,G:2,J:2,K:2,Q:2,S:2,X:2,Z:2,D:3,T:3,L:4,M:5,N:5,R:6},a=0,c=0;(e=n.charAt(a++))&&c<4;)(t=i[e])?t!==r&&(o[c++]=r=t):(c+=1===a,r=0);return o[0]=n.charAt(0),o.join("")},Array.prototype.sortByKey=function(t,e){return e||(e=!1),this.sort(function(r,n){var o=r[t],i=n[t];return e?-1*(o<i?-1:o>i?1:0):o<i?-1:o>i?1:0})},String.prototype.similar=function(t){for(var e=this,r=[],n=-1,o={},i=[],a=[],c=0;c<t.length;c++){var s=t[c].toLowerCase();r.push({original:s,clean:s.toEnglish(),soundEx:s.toEnglish().toUpperCase().soundEx()})}for(var u=0;u<r.length;u++){var p=r[u],d=e.levenshtein(p.original,1,2,1),l=e.toEnglish().levenshtein(p.clean,1,2,1),f=0===d||0===l?0:e.toEnglish().toUpperCase().soundEx().levenshtein(p.soundEx,1,2,1);p.ans=[d,l,f],p.calc=Math.floor(f+l/2+d),(p.calc<=n||n<0)&&(n=p.calc,o=p),i.push({o:p.original,lo:d,lc:l,ls:f,c:p.calc})}i.sortByKey("c");for(var h=0;h<i.length;h++){var g=i[h];a.push({original:g.o,score:g.c,levenshtein:g.lo,english:g.lc,soundEx:g.ls})}return{result:o.original,score:n,anothers:a}},String.prototype.pass=function(){for(var t=this,e=0;e<arguments.length;e++){var r=arguments[e];t=t.replace(new RegExp(function(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}("%%")),r)}return t};var Utils={isHepsiburada:function(){return location.host.indexOf(HEPSIBURADA)>-1},collectionArrToSingleObj:function(t){for(var e={},r=[],n=0;n<t.length;n++)for(var o in t[n])if(t[n].hasOwnProperty(o)){var i=t[n][o];e[o]=i,r.push(i)}return e},getStrId:function(){return(+new Date+"").split("").map(function(t){return String.fromCharCode(97+parseInt(t))}).join("")},guid:function(){for(var t=[],e=0;e<8;e++)t.push(this.s4());return t.join("-")},s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},Path=function(t,e){return this.keys=[],this.pattern=pathToRegexp(t,this.keys),this.result=this.pattern.exec(e),this};Path.prototype.test=function(){return this.result},Path.prototype.params=function(){return this.getParams(this.result,this.keys)},Path.prototype.getParams=function(t,e){for(var r={},n=1;n<t.length;n++){var o=e[n-1].name,i=this.decodeParam(t[n]);!i&&Object.prototype.hasOwnProperty.call(r,o)||(r[o]=i)}return r},Path.prototype.decodeParam=function(t){if("string"!=typeof t||0===t.length)return t;try{return decodeURIComponent(t)}catch(e){throw e instanceof URIError&&(e.message="Failed to decode param '"+t+"'",e.status=e.statusCode=400),e}};var Proxy={inject:function(t){var e=document.createElement("script");e.type="text/javascript",e.text="("+t+')("");',document.body.appendChild(e)},execute:function(t,e){return new window.Promise(function(r,n){var o="execute_"+Utils.getStrId();document.body.addEventListener(o,function(e){var n={};n[t]=e.detail.toString().trim(),r(n)}),this.inject("function () {         document.body.dispatchEvent(new CustomEvent('%%', {detail: eval('%%')}));      }".pass(o,e))}.bind(this))},ajax:function(t){var e="ajax_"+Utils.getStrId();document.body.addEventListener(e,function(e){t(e.detail.toString().trim())}),this.inject("function() {        var oldSend = XMLHttpRequest.prototype.send;        XMLHttpRequest.prototype.send = function () {          var oldOnLoad = this.onload;          this.onload = function () {             document.body.dispatchEvent(new CustomEvent('%%', {detail: this.responseText}));             if (oldOnLoad) {              oldOnLoad.apply(this, arguments);            }          };          oldSend.apply(this, arguments);        };      }".pass(e))},hashChange:function(t){var e="hashChange_"+Utils.getStrId();document.body.addEventListener(e,function(e){t(e.detail.toString().trim())}),this.inject("function () {      window.addEventListener('hashchange', function (e) {        document.body.dispatchEvent(new CustomEvent('%%', {detail: location.href}));      }, false);    }".pass(e))},clickTracker:function(t,e){var r="clickTracker_"+Utils.getStrId();document.body.addEventListener(r,function(t){e(t.detail.toString().trim())}),this.inject("function () {      '%%'.split('%')        .forEach(function (s) {          document.querySelectorAll(s)            .forEach(function (e) {              e.addEventListener('click', function (e) {                document.body.dispatchEvent(new CustomEvent('%%', {detail: this.href}))              }, false);            });        });    }".pass(t.join("%"),r))}},Sniffer=function(){};Sniffer.prototype.ajax=function(t){Proxy.ajax(t)},Sniffer.prototype.hashChange=function(t){Proxy.hashChange(t)};var Tracker=function(){};Tracker.prototype.click=function(t,e){Proxy.clickTracker(t,e)};var Search=function(t,e){var r=document.createElement("iframe"),n=Utils.getStrId();r.style.display="none",r.id=n,r.src=SEARCH_URL+t,r.name=e,document.body.appendChild(r),r.onload=function(){}},isTop=!0,host=location.host,site=host.startsWith(HOST_JOKER_PREFIX)?host.substr(HOST_JOKER_PREFIX.length):host,App={init:function(t){var e=new Path(t.product_detail,location.pathname);if(this.initSniffers(),e.test()){e.params();App.collect(t)}},tracker:function(t){var e=new Path(t.detect_url,location.pathname);if(e.test()){e.params();this.initTrackers(t.selectors)}},initSniffers:function(){var t=new Sniffer;AJAX_SNIFFER&&t.ajax(this.onAjax.bind(this)),HASH_CHANGE_SNIFFER&&t.hashChange(this.onHashChange.bind(this))},initTrackers:function(t){var e=new Tracker;CLICK_TRACKER&&e.click(t,function(t){App.sendToPlugin({clickTracker:t})})},onAjax:function(t){console.log("[SNIFFER-AJAX]",t)},onHashChange:function(t){console.log("[SNIFFER-HASH-CHANGE]",t)},collect:function(t){window.Promise.all([Proxy.execute("product_name",t.product_name),Proxy.execute("product_brand",t.product_brand),Proxy.execute("product_price",t.product_price)]).then(App.done)},detect:function(t){for(var e=[],r=0;r<t.length;r++)e=e.concat(App.analyze(t[r]));return e=e.filter(function(t,e,r){return r.indexOf(t)===e}),e.length},done:function(t){var e=Utils.collectionArrToSingleObj(t);if(t=[e.product_name,e.product_brand],!BRAND_DETECTION||App.detect(t)){var r=App.query(t);Search(r,e.product_price)}},query:function(t){for(var e=[],r=[],n=0;n<t.length;n++)for(var o=0;o<t.length;o++)n!==o&&t[n].indexOf(t[o])>-1&&r.push(o);for(var i=0;i<t.length;i++)-1===r.indexOf(i)&&e.push(t[i]);return e.join(" ").split(" ").map(function(t){return t.trim()}).slice(0,QUERY_SLICE_COUNT).join(" ").trim().toLowerCase()},analyze:function(t){for(var e=t.trim().toLowerCase().split(" "),r=[],n=0;n<e.length;n++){var o=e.slice(n,1+n).join(" ").trim(),i=e.slice(n,2+n).join(" ").trim(),a=e.slice(n,3+n).join(" ").trim(),c=o.similar(brands),s=i.similar(brands),u=a.similar(brands),p=App.select([c,s,u],[o,i,a]);p.score<=EXPECTED_SCORE&&r.push(p)}return r.map(function(t){return t.text})},select:function(t,e){var r=t.map(function(t,r){return{text:t.result,score:t.score,from:e[r]}});return App.getMinAndMax(r,"score").min},getMinAndMax:function(t,e){if(!t.length)return null;for(var r,n=t[0],o=t[0],i=t.length-1;i>=0;i--)r=t[i],r[e]<n[e]&&(n=r),r[e]>o[e]&&(o=r);return{min:n,max:o}},sendToPlugin:function(t){chrome.runtime.sendMessage(t,function(t){})},pushDevLog:function(t){App.sendToPlugin({devLog:t})}};window.onload=function(){map.hasOwnProperty(site)?Utils.isHepsiburada()||App.init(map[site]):tracker_map.hasOwnProperty(site)&&App.tracker(tracker_map[site]),App.sendToPlugin({run:!0})};